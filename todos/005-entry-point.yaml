title: Создать точку входа workers/bot/__main__.py
status: done
created_at: 07.02.2026
completed_at: 07.02.2026

description: |
  Точка входа бота по паттерну royalestate_bot.
  Инициализирует BotApplication, регистрирует хендлеры, запускает polling.

recommendation: |
  - workers/bot/__main__.py:
    1. Загрузить переменные из .env (python-dotenv)
    2. Прочитать BOT_TOKEN, BOT_DB_URL, REDIS_URL (без ANTHROPIC_API_KEY)
    3. Создать BotApplication(bot_token, database_url, redis_url, ...)
       - phrases_json_path: Path("data/phrases.json")
       - roles_json_path: Path("data/roles.json")
       - languages_json_path: Path("data/languages.json")
    4. Создать AgentClient()
       - cwd="/home/sumarokov" — авторизация через подписку Claude Code
    5. Создать TextMessageHandler с зависимостями
    6. Зарегистрировать handler через message_handler_registry.register(
         handler=text_handler, content_types=["text"]
       )
    7. app.run()
  - Обработка исключений на верхнем уровне (try-except в __main__)

solution: |
  Создан workers/bot/__main__.py по паттерну royalestate_bot.
  Загружает .env через python-dotenv, читает BOT_TOKEN/BOT_DB_URL/REDIS_URL,
  инициализирует BotApplication с data/ файлами, создаёт AgentClient,
  SendToAgentAction и TextMessageHandler, регистрирует handler для text,
  запускает polling. try-except на верхнем уровне в if __name__ == "__main__".
